<!--
  File: mini_insta/templates/mini_insta/show_post.html
  Author: Saksham Goel (saksham@bu.edu), 09/25/2025
  Description: Displays a single post with its details, including photos.
-->

{% extends "mini_insta/base.html" %}

{% block content %}

<!-- Post details -->
<h1>Post by @{{ post.profile.username }}</h1>
<p>{{ post.timestamp|date:"M j, Y g:i a" }}</p>

<!-- Like count -->
<p style="color:#6b7280; margin: 8px 0;">
  <strong>{{ post.get_num_likes }}</strong> likes
</p>

{% if post.caption %}<p>{{ post.caption }}</p>{% endif %}

<!-- Post actions -->
{% if request.user.is_authenticated and request.user == post.profile.user %}
  <div style="margin: 16px 0;">
      <a href="{% url 'update_post' post.pk %}" class="btn btn_primary">Update Post</a>
      <a href="{% url 'delete_post' post.pk %}" class="btn btn_secondary" style="background-color: #dc2626; color: white;">Delete Post</a>
  </div>
{% elif request.user.is_authenticated %}
  <div style="margin: 16px 0;">
    <form action="{% url 'like_post' post.pk %}" method="post" style="display: inline;">
      {% csrf_token %}
      <button type="submit" class="btn btn_primary">‚ù§Ô∏è Like</button>
    </form>
    <form action="{% url 'unlike_post' post.pk %}" method="post" style="display: inline; margin-left: 8px;">
      {% csrf_token %}
      <button type="submit" class="btn btn_secondary">üíî Unlike</button>
    </form>
  </div>
{% endif %}

<hr>

<!-- Photos associated with the post -->
<h2>Photos</h2>
{% for photo in post.get_all_photos %}
  <div style="margin-bottom:12px;">

      {% if photo.get_image_url %}
        <img src="{{ photo.get_image_url }}" alt="Photo {{ forloop.counter }}" style="max-width:600px;">
      {% else %}
        <p>No image available.</p>
      {% endif %}
  </div>
{% empty %}
  <p>No images for this post.</p>
{% endfor %}

<hr>

<!-- Comments section -->
<h2>Comments</h2>
{% for comment in post.get_all_comments %}
  <div style="margin: 12px 0; padding: 12px; background-color: #f9fafb; border-radius: 8px;">
    <div style="display: flex; align-items: center; margin-bottom: 8px;">
      <strong>@{{ comment.profile.username }}</strong>
      <span style="color:#6b7280; margin-left: 8px; font-size: 0.9em;">
        {{ comment.timestamp|date:"M j, Y g:i a" }}
      </span>
    </div>
    <p style="margin: 0;">{{ comment.text }}</p>
  </div>
{% empty %}
  <p style="color:#6b7280;">No comments yet.</p>
{% endfor %}

<div style="margin-top: 20px; text-align: center;">
  <a href="{% url 'show_profile' post.profile.pk %}" class="btn btn_secondary">Back to profile</a>
</div>

{% endblock %}
