<!--
  File: mini_insta/templates/mini_insta/show_profile.html
  Author: Saksham Goel (saksham@bu.edu), 09/26/2025
  Description: Displays a single Profile with larger image, handle, display name,
  and bio text. Placeholder text included for future features (followers, posts).
-->

{% extends 'mini_insta/base.html' %}

{% block content %}

<!-- Main content: single profile detail -->
<main class="card profile_main">
  <div>
    <img src="{{ profile.profile_image_url }}" alt="Profile image" class="profile_image">
  </div>

  <div class="profile_text">
    <h2>@{{ profile.username }}</h2>
    <h4>{{ profile.display_name }}</h4>
    <p>{{ profile.bio_text }}</p>
    
    <p style="color:#9ca3af; font-size:0.9em; margin-top:8px;">
      Joined {{ profile.join_date|date:"F Y" }}
    </p>

    <p style="color:#6b7280; margin-top:12px;">
      <a href="{% url 'show_followers' profile.pk %}" style="text-decoration: none; color: inherit;">
        <strong>{{ profile.get_num_followers }}</strong> Followers
      </a>
      <span style="margin: 0 8px;">•</span>
      <a href="{% url 'show_following' profile.pk %}" style="text-decoration: none; color: inherit;">
        <strong>{{ profile.get_num_following }}</strong> Following
      </a>
      <span style="margin: 0 8px;">•</span>
      <strong>{{ profile.get_all_posts.count }}</strong> Posts
    </p>
    
    {% if request.user.is_authenticated and request.user == profile.user %}
      <div style="margin-top: 16px;">
        <a href="{% url 'update_profile' %}" class="btn btn_primary">Update Profile</a>
      </div>
    {% elif request.user.is_authenticated %}
      <div style="margin-top: 16px;">
        <form action="{% url 'follow_profile' profile.pk %}" method="post" style="display: inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn_primary">Follow</button>
        </form>
        <form action="{% url 'unfollow_profile' profile.pk %}" method="post" style="display: inline; margin-left: 8px;">
          {% csrf_token %}
          <button type="submit" class="btn btn_secondary">Unfollow</button>
        </form>
      </div>
    {% endif %}
  </div>
  
</main>
<hr style="margin: 16px 0;">

<!-- Posts list -->
<section>
  <h3>Posts</h3>

  {% for post in profile.get_all_posts %}
    <div style="margin: 12px 0;">
      <a href="{% url 'show_post' post.pk %}" style="text-decoration: none; color: inherit;">
        {% with first_photo=post.get_all_photos.0 %}
          {% if first_photo and first_photo.get_image_url %}
            <img src="{{ first_photo.get_image_url }}" alt="Post {{ forloop.counter }} thumbnail" style="max-width: 320px; height: auto;">
          {% else %}
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/1024px-No_image_available.svg.png" alt="No image" style="max-width: 320px; height: auto;">
          {% endif %}
        {% endwith %}
        <div style="margin-top: 6px;">
          <span style="color:#6b7280;">{{ post.timestamp|date:"M j, Y g:i a" }}</span>
          {% if post.caption %}
            <p style="margin: 4px 0 0 0;">{{ post.caption }}</p>
          {% endif %}
        </div>
      </a>
    </div>
  {% empty %}
    <p style="color:#6b7280;">This profile hasn't posted yet.</p>
  {% endfor %}
  
  {% if request.user.is_authenticated and request.user == profile.user %}
    <div style="margin-top: 16px; text-align: center;">
      <a href="{% url 'create_post' %}" class="btn btn_primary">Create New Post</a>
    </div>
  {% endif %}
</section>

{% endblock %}
